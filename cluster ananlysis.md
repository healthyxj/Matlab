# 聚类分析
可用于模式识别、数据分析、图像处理、市场研究、客户分割 、Web文档分类。

聚类是按照某个特定的标准(如距离准则)把一个数据集分割成不同的类或簇，使得<b>同一个簇内的数据对象的相似性尽可能大，同时不在同一簇中的数据对象的差异性也尽可能大</b>。即聚类后同一类的数据尽可能聚集到一起，不同数据尽量分离。
~~~
聚类分析根据一批样品的许多观测指标，按照一定的数学公式具体地计算一些样品或一些参数 (指标)的相似程度，把相似的样品或指标归为一类，把不相似的归为一类。

要思考样本点之间用什么刻画相似程度？样本点与类之间用什么刻画相似程度？类与类之间用什么刻画相似程度？
~~~
## 1、距离和相似系数
### a、变量测量尺度的类型
为了将变量进行分类，就需要研究变量之间的关系。

通常按照测量变量的尺度不同分为三类：
* 间隔尺度
  * 指标度量用数量表示，如长度、重量、收入
  * 得到的数量是离散数量
* 顺序尺度
  * 指标度量没有明确的数量表示，只有次序关系；或虽用数量表示，但是相邻两数量之间的差距并不相等
  * 只表示一个有序状态序列，如酒的味道有好、中、次三等，虽然有次序关系，但没有数量表示
* 名义尺度
  * 指标度量时只有一些特性状态，如眼镜的颜色
  * 在名义尺度中只取两种特性状态的变量是很重要的，如性别中的男与女
### b、数据的变换处理
将原始数据矩阵中的每个元素，按照某种特定的运算把它变成一个新值，而且数值的变化不依赖于原始数据集合中其它数据的新值。

如X是一个n*p的矩阵，X=[x₁₁ x₁₂ …… x₁p;x₂₁ x₂₂ …… x₂p;……;xn₁ xn₂ ……xnp];

xij*表示变换后的值，xj'表示均值
* 中心化变换: xij* = xij - xj'
  * 结果：每列数据之和为0，即每个变量的均值为0；且每列数据的平方和是该列变量样本方差的n-1倍
  * 便于计算方差与协方差
* 极差规格化变换: xij* = (xij - min(xij)) / Rj; Rj = max(xij) - min(xij)
  * 数据矩阵中每列的最大数值为1，最小数值为0
  * 变换后不再有量纲
* 标准化变换: xij* = (xij - xj') / Sj; Sj为xij的方差
  * 每个变量即数据矩阵中每列数据的平均值为0，方差为1，不再具有量纲
  * 变化后，数据矩阵中任何两列数据乘积之和是两个变量相关系数的n-1倍
  * <b>一般来说，得到数据后都要进行标准化变换</b>
* 对数变换: xij* = log(xij)
* 中心化变换: xij* = xij -xj'
### c、样品间亲疏程度的测度
研究样品或变量的亲疏程度的数量指标有两种： 一种叫距离，它是将每一个样品看作p维空间的一个点， 并用某种度量测量点与点之间的距离，距离较近的归为一类，距离较远的点应属于不同的类；另一种叫相似系数，性质越接近的变量或样品，它们的相似系数越接近于1或-1，而彼此无关的变量或样品它们的相似系数则越接近于0，相似的为一类，不相似的为不同类。

变量之间的聚类（R型聚类分析），常用相似系数来测度变量之间的亲疏程度。

样品之间的聚类（Q型聚类分析），常用距离来测度样品之间的亲疏程度。

#### 定义距离的准则
dij≥0,dij=0当且仅当i=j，dij=dji，dij≤dik+dkj
#### 常用样本点间距离的算法
设xi = (xi1, xi2, ……, xip)'和xj = (xj1, xj2, ……，xjp)'是第i和j个样品的观测值，则二者之间的距离为
|||
|:--:|:--:|
|欧氏距离|dij = (Σ(xik - xjk)²)½|
|杰氏距离|dij = (Σ((xik)½ - (xjk)½)²)½|
|兰氏距离|dij = Σ绝对值(xik - xjk) / (xik + xjk)|
|马氏距离|dij² = (xi - xj)' *  Σ^-1 * (xi - xj)|

~~~
明氏距离是将欧氏距离中2换成任意常数的结果。
明氏距离没有考虑各个变量之间的相关性和重要性。
马氏距离不仅考虑了观测变量之间的相关性，而且也考虑到了各个指标取值的差异程度。
~~~
  
#### 相似系数的算法
设xi = (xi1, xi2, ……, xip)'和xj = (xj1, xj2, ……，xjp)'是第i和j个样品的观测值，则二者之间的相似测度为γ = Σ(xik - xi')(xjk - xj') / ([Σ(xik - xi')²] * [Σ(sjk - sj')²])½
#### 样本数据与类、类与类之间的度量
最短距离，最长距离，组间平均距离，组内平均连接法（包括组内的距离），重心法（均值点之间的距离），离差平方和法连接（详见代码部分）
  
## 2、系统聚类方法
开始各样本自成一类。

1、根据样品的特征，规定样品之间的距离dij，共有Cn²个。将所有列表，记为D（0）表，该表是一张对称表。所有的样本点各自为一类。

2、选择D（0）表中最小的非零数，不妨假设为dpq，于是将Gp和Gq合并为一类，记为 Gr = {Gp, Gq}

3、利用递推公式计算新类与其它类之间的距离。分别删除D(0)表的第p、q行和第p、q列，并新增一行和一列添上的结果，产生D(1)表。

4、在D（1）表再选择最小的非零数，其对应的两类又构成新类，再利用递推公式计算新类与其它类之间的距离。分别删除D（1）表的相应的行和列， 并新增一行和一列添上的新类和旧类之间的距离。结果，产生D（2）表。类推直至所有的样本点归为一类为止。
### 确定类的个数
给定阈值-通过观测聚类图，给出合适的阈值T，要求类与类之间的距离不要超过T值。
### 主要的步骤
* 选择变量
  * 要反映变量的特征
  * 值要有明显的差异
  * 变量之间不能高度相关
* 计算相似性
* 聚类
  * 选择聚类的方法
  * 确定形成的类数
* 聚类结果的解释和证实
  * 解释希望能够对各个类的特征进行准确的描述，给每类起一个合适的名称



